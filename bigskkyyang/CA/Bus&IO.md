# 버스 구조 & I/O

## 시스템 버스

컴퓨터의 핵심부품들은 모두 **메인보드(main borad)**에 연결된다.

메인보드에 연결된 부품들은 서로 정보를 주고받을 수 있는데, 이는 메인보드 내부에 **버스(bus)**라는 통로가 있기 때문이다. 컴퓨터 내부에는 다양한 종류의 버스가 있지만, 가장 중요한 버스는 컴퓨터의 네 가지 핵심 부품을 연결하는 **시스템 버스(system bus)**이다.

시스템 버스는 주소 버스(주소를 주고받는 통로), 데이터 버스(명령어와 데이터를 주고받는 통로), 제어 버스(제어 신호를 주고받는 통로)로 구성되어 있다.

예시

1. 제어버스로 '메모리 읽기' 제어 신호를 보내고,
2. 주소버스로 읽고자 하는 주소를 보내고,
3. 메모리는 데이터 버스로 CPU가 요청한 주소에 있는 내용을 보낸다.

저장할 때도,
1. 데이터 버스로 메모리에 저장할 값을 보내고,
2. 주소 버스로 저장할 주소를 보내고,
3. 제어 버스를 통해 '메모리 쓰기'신호를 보낸다.

![시스템버스](./image/시스템버스.png)

---

## I/O

**Input/Output**의 약자로, **입력/출력**을 의미한다. 컴퓨터 시스템과 외부 세계 또는 다른 구성 요소 간의 데이터 전송을 일컫는 용어. 사용자가 컴퓨터에 데이터를 입력하고, 컴퓨터가 그 결과를 사용자에게 보여주는 모든 과정이 I/O의 범주에 속한다.

I/O는 컴퓨터가 외부와 소통하는 유일한 수단이다. CPU가 아무리 빠르더라도, I/O 과정이 비효율적이면 시스템 전체의 성능이 저하될 수 있다. 따라서 I/O 성능을 최적화하는 것도 컴퓨터 시스템 설계의 중요한 부분 중 하나이다.

### I/O의 작동 방식

I/O는 크게 두 가지 방식으로 처리될 수 있다.

1.  **동기적 I/O (Synchronous I/O):** I/O 작업이 완료될 때까지 다른 작업을 수행하지 않고 기다림. 이는 프로그램의 흐름을 멈추게 하지만, 구현이 간단하다는 장점이 있다.
2.  **비동기적 I/O (Asynchronous I/O):** I/O 작업을 시작한 후, 작업이 완료되기를 기다리지 않고 다른 작업을 계속 수행. 이는 시스템의 효율을 높이지만, 구현이 더 복잡하다.

대부분의 현대 운영 체제는 시스템의 응답성과 효율성을 위해 비동기 I/O를 활용한다. ex. 웹 브라우저가 웹 페이지를 다운로드할 때, 사용자는 다운로드가 완료될 때까지 기다리지 않고 다른 탭에서 작업을 하는 것

-----

## 장치 컨트롤러와 장치 드라이버

### 장치 컨트롤러(Device Controller)

입출력장치는 컴퓨터에 직접 연결되지 않고 장치컨트롤러를 통해 연결된다. 장치 컨트롤러는 입출력제어기(I/O Controller), 입출력 모듈(I/O Module)등으로 다양하게 불린다. 모든 입출력 장치는 각자의 장치 컨트롤러를 통해 컴퓨터 내부와 정보를 주고받고, 장치 컨트롤러는 하나 이상의 입출력장치와 연결되어 있다.

장치 컨트롤러는 대표적으로 다음과 같은 역할을 한다.

- CPU와 입출력장치 간의 통신 중개
- 오류검출
- 데이터 버퍼링

입출력장치의 종류가 많아 정보 규격화가 어려웠던 문제는 장치 컨트롤러가 번역가 역할을 함으로써 해결하며, 그 과정에서 자신과 연결된 입출력장치에 문제가 없는지 오류 검출을 한다. 일반적으로 전송률이 높은 CPU와 일반적으로 전송률이 낮은 입출력장치와의 전송률 차이를 데이터 버퍼링으로 완화한다.

#### 장치 컨트롤러의 내부구조(간략화 버전)

1. **데이터 레지스터**: CPU와 입출력장치 사이에 주고받을 데이터가 담기는 레지스터. 버퍼 역할을 한다. 최근 주고받는 데이터가 많은 입출력장치에서는 레지스터 대신 RAM을 사용하기도 한다.
2. **상태 레지스터**: 입출력장치가 입출력 작업을 할 준비가 되었는지, 입출력 작업이 완료되었는지, 입출력 장치에 오류는 없는지 등의 상태 정보가 저장된다.
3. **제어 레지스터**: 입출력장치가 수행할 내용에 대한 제어 정보와 명령을 저장한다.

### 장치 드라이버(Device Driver)

장치 컨트롤러의 동작을 감지하고 제어함으로써 장치 컨트롤러가 컴퓨터 내부와 정보를 주고받을 수 있게 하는 프로그램. 장치 컨트롤러가 입출력장치를 연결하기 위한 하드웨어적 통로라면, 장치 드라이버는 입출력장치를 연결하기 위한 소프트웨어적인 통로.

-----

## 장치 컨트롤러와 CPU의 정보 교환 방식

### 1. 프로그램 입출력 (Programmed I/O)

CPU가 직접 입출력장치를 제어하는 방식. CPU는 입출력 작업을 명령하고, 작업이 끝날 때까지 기다린다.

* **작동 방식**: CPU가 프로그램 명령어에 따라 장치 컨트롤러와 상호작용하며 입출력 작업을 수행한다.
* **단점**: 입출력 장치가 CPU보다 훨씬 느리기 때문에, CPU가 입출력 작업 완료를 기다리는 동안 비효율적으로 시간을 낭비하게 된다.

입출력 장치와 메모리를 다루는 주소 공간을 어떻게 구분하느냐에 따라 두 가지로 나뉜다.

* **메모리 맵 입출력 (Memory-Mapped I/O)**: 메모리와 입출력장치의 주소 공간을 하나로 합쳐서 관리한다. CPU는 메모리 접근 명령어만으로 입출력장치를 제어할 수 있다.
* **고립형 입출력 (Isolated I/O)**: 메모리 주소 공간과 입출력장치 주소 공간을 분리하여 관리한다. 입출력 전용 명령어를 사용해 장치 컨트롤러와 통신한다.

### 2. 인터럽트 기반 입출력 (Interrupt-driven I/O)

입출력 장치가 CPU에 인터럽트를 보내 작업 완료를 알리는 방식.

* **작동 방식**: CPU는 장치 컨트롤러에 입출력 작업을 명령한 후, 다른 작업을 수행한다. 장치 컨트롤러가 입출력 작업을 마치면, CPU에 인터럽트 요청 신호를 보낸다. CPU는 하던 작업을 멈추고 인터럽트 서비스 루틴(ISR)을 실행하여 입출력 결과를 처리한다.
* **장점**: CPU가 입출력 작업이 끝날 때까지 기다릴 필요가 없어 CPU의 효율이 높아진다.

---

### 3. DMA 입출력 (DMA I/O)

DMA 컨트롤러라는 별도의 하드웨어가 CPU의 개입 없이 직접 메모리에 접근하여 입출력 작업을 수행하는 방식.

* **작동 방식**: CPU는 DMA 컨트롤러에게 입출력 작업을 지시하고, DMA 컨트롤러가 CPU를 대신해 메모리와 입출력장치 간의 데이터를 직접 주고받는다. 데이터 전송이 완료되면 DMA 컨트롤러가 CPU에 인터럽트를 보내 작업 완료를 알린다.
* **장점**: 대용량 데이터를 전송할 때 CPU가 데이터 이동에 관여하지 않아 CPU의 부담을 최소화할 수 있다.
