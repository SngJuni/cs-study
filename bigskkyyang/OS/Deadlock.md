# Deadlock(교착상태)
개념 : 일련의 프로세스들이 서로가 가진 자원을 기다리며 block 되어 더 이상 진행이 될 수 없는 상태. => 둘 이상의 프로세스가 결코 일어나지 않을 사건을 기다리는 상태

## 교착 상태의 발생 원인
- 시스템 자원에 대한 요구가 엉킨 상태로, 두 프로세스가 사용하는 자원을 서로 기다리고 있을 때 발생한다.
- ex. P1이 R1을 갖고 있고, P2는 R2를 갖고 있다. 그런데 P2는 R1을 필요로 하고 P1은 R2를 필요로 한다. 서로에게 필요한 것을 서로가 갖고 있지만 요구가 뒤엉킨 상태로 계속 서로가 가진 자원을 받을 때 까지 무한정 대기

## 프로세스가 자원을 사용하는 절차
- 자원 요청 (Request)
  - 프로세스가 자원을 요청하는 절차
  - 만약 다른 프로세스가 자원을 사용하고 있어 받을 수 없다면 대기
- 자원 받기 (Allocate)
- 자원 사용 (Use)
  - 프로세스가 받은 자원을 사용
- 자원 해제(Release)
  - 프로세스가 자원을 놓아준다.

-> Deadlock은 모든 프로세스가 Request 되어 있는 상태

## Deadlock Chraterization

교착 상태가 발생하기 위해 다음 4가지 조건을 만족해야 한다.

### 1. Mutual exclusion (상호 배제)
- 매 순간 하나의 프로세스만이 자원을 사용할 수 있다.

### 2. Hold and wait (보유 대기)
- 자원을 가진 프로세스가 다른 자원을 기다릴 때, 보유하고 있는 자원을 놓지 않고 계속 가지고 있다.

### 3. No preemption (비선점)
- 프로세스는 OS에 의해 강제로 자원을 빼앗기지 않는다.
- 자원을 점유하고 있는 프로세스가 해당 자원을 해제해야 한다는 것.

### 4. Circular wait (순환대기)
- 자원을 기다리는 프로세스 간에 사이클이 형성되어야 한다.

## 교착 상태를 해결하는 방법
1. 예방 (Deadlock Prevention)
- 교착 상태를 유발하는 네 가지 필수 조건 중 하나 이상을 아예 충족시키지 않도록 시스템을 설계
- 교착 상태 발생을 원천적으로 봉쇄하지만, 자원의 효율성과 시스템의 처리량이 감소할 수 있음
  - 상호배제 -> 공유 가능한 자원 사용
  - 보유대기 -> 자원 요청 시 다른 자원을 보유하지 않도록 함
  - 비선점 -> 자원 선점 허용
  - 순환대기 -> 자원 순서 매기기

2. 회피 (Deadlock Avoidance)
- 시스템이 안전 상태를 유지할 수 있는 경우에만 자원 요청을 허용함
- 시스템이 자원 할당 상태를 지속적으로 검사하고, 교착 상태가 발생할 가능성이 있는 요청은 거절함

3. 탐지 및 복구 (Detection & Recovery)
- 자원 할당 그래프를 사용하여 순환대기가 있는지 확인
- 탐지 알고리즘을 사용하여 시스템에 교착 상태가 있는지 주기적으로 확인
- 프로세스 강제 종료
  - 교착 상태에 있는 프로세스 중 하나 또는 여러 개를 강제 종료하여 해당 프로세스가 보유하고 있던 자원을 해제한다.
- 자원 선점
  - 교착 상태에 있는 프로세스에서 자원을 강제로 빼앗아(선점) 다른 프로세스에 할당
