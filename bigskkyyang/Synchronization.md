# 동기화 기법

멀티프로세스 또는 멀티스레드 환경에서는 여러 프로세스나 스레드가 하나의 자원을 동시에 접근할 수 있다. 이때 데이터의 일관성을 유지하고, 예상치 못한 문제를 방지하기 위해 **동기화(Synchronization)** 기법이 사용된다.

---

## 1. 동기화의 필요성?

동기화는 **공유 자원(Shared Resource)**에 여러 프로세스/스레드가 동시에 접근할 때 발생하는 문제를 해결하기 위해 필수적이다. 대표적인 문제로 경쟁 상태가 있다.

* **경쟁 상태 (Race Condition)**: 두 개 이상의 프로세스/스레드가 공유 자원에 동시에 접근하여 최종 결과가 접근 순서에 따라 달라지는 상황

---

## 2. 임계 구역 (Critical Section)

동기화 기법의 핵심은 **임계 구역**을 설정하는 것

* **임계 구역**: 공유 자원에 접근하는 코드 영역. 한 번에 하나의 프로세스/스레드만 이 영역에 들어와서 코드를 실행할 수 있도록 보장해야 한다.

임계 구역 문제를 해결하기 위한 세 가지 조건
1.  **상호 배제 (Mutual Exclusion)**: 한 프로세스/스레드가 임계 구역에 들어가 있으면, 다른 프로세스/스레드는 들어갈 수 없다.
2.  **진행 (Progress)**: 임계 구역에 진입하려는 프로세스/스레드가 아무도 없으면, 대기 중인 다른 프로세스/스레드가 진입을 결정할 수 있어야 한다.
3.  **한정된 대기 (Bounded Waiting)**: 어떤 프로세스/스레드도 무한히 임계 구역 진입을 기다려서는 안 된다.

---

## 3. 주요 동기화 기법 종류

### 뮤텍스 (Mutex)

* **개념**: **Mutual Exclusion(상호 배제)**의 줄임말. 화장실의 열쇠에 비유하자면, 열쇠를 가진 사람만이 화장실(임계 구역)에 들어갈 수 있으며, 사용 후에는 열쇠를 반납해야 다른 사람이 사용할 수 있다.
* **특징**: 한 번에 하나의 스레드만 공유 자원에 접근하도록 한다. **락(Lock)**과 **언락(Unlock)** 개념을 사용함.
* **용도**: 임계 구역을 보호하여 경쟁 상태를 방지하는 데 사용됨.

### 세마포어 (Semaphore)

* **개념**: 여러 사람이 동시에 이용할 수 있는 주차장 입구의 **티켓 발급기**와 같다.
* **특징**: 공유 자원에 접근할 수 있는 프로세스/스레드의 수를 카운트하는 정수 변수(카운터)를 가진다. 카운터는 **0 이상의 정수 값**
* **종류**:
    * **이진 세마포어 (Binary Semaphore)**: 0 또는 1의 값만 가지는 세마포어로, 뮤텍스와 비슷하게 작동
    * **계수형 세마포어 (Counting Semaphore)**: 2 이상의 정수 값을 가질 수 있으며, 공유 자원 인스턴스가 여러 개 있을 때 사용됨
* **연산**:
    * `P(wait)`: 자원 사용 전 신호를 기다리는 연산. 자원을 얻으면 카운터 값을 감소시킨다. 카운터가 0이면 대기.
    * `V(signal)`: 자원 사용 후 신호를 보내는 연산. 카운터 값을 증가시킨다. 대기 중인 스레드가 있으면 깨움.

---

### 💡 뮤텍스 vs. 세마포어

| 구분 | 뮤텍스 (Mutex) | 세마포어 (Semaphore) |
| :--- | :--- | :--- |
| **개념** | 상호 배제 (자물쇠) | 자원에 대한 접근 제어 (카운터) |
| **소유권** | 락을 건 스레드만 해제 가능 | P/V 연산은 어느 스레드나 가능 |
| **용도** | 임계 구역 보호 | 공유 자원 개수 제어 |
| **카운터** | 0과 1만 가질 수 있는 이진 세마포어의 특수한 경우 | 정수 값 사용 |

---

### 🔄 모니터 (Monitor)

* **개념**: 뮤텍스와 세마포어의 복잡성을 줄이기 위해 고안된 고급 동기화 기법
* **특징**: 공유 데이터와 해당 데이터를 조작하는 프로시저(함수)를 하나의 캡슐로 묶는다. 모니터 내부에는 한 번에 하나의 스레드만 진입할 수 있도록 **상호 배제**가 자동적으로 보장된다.
* **용도**: 프로그래머가 복잡한 락/언락, P/V 연산을 직접 관리하지 않아도 되므로, 동기화 로직을 더 안전하고 쉽게 구현할 수 있다.

---

### 💀 교착 상태 (Deadlock)

**교착 상태**는 두 개 이상의 프로세스/스레드가 서로가 가진 자원을 기다리며 무한히 대기하는 상태

교착 상태가 발생하는 4가지 필요 조건
1.  **상호 배제 (Mutual Exclusion)**: 한 번에 한 프로세스만 자원을 사용할 수 있다.
2.  **점유 및 대기 (Hold and Wait)**: 자원을 가진 상태에서 다른 자원을 기다린다.
3.  **비선점 (No Preemption)**: 다른 프로세스가 자원을 강제로 뺏을 수 없다.
4.  **순환 대기 (Circular Wait)**: 자원을 기다리는 프로세스들이 원형으로 연결되어 있다.

### 🏭 생산자-소비자 문제 (Producer-Consumer Problem)

* **생산자(Producer)**: 데이터를 생성하여 버퍼에 넣는다.
* **소비자(Consumer)**: 버퍼에 있는 데이터를 가져와 사용한다.
* **문제**: 생산자는 버퍼가 가득 찼을 때 대기해야 하고, 소비자는 버퍼가 비어 있을 때 대기해야 한다. 또한, 버퍼에 접근하는 동안 동시 접근 문제를 막아야 한다.
* **해결**: 뮤텍스, 세마포어, 모니터 등을 사용하여 버퍼 접근을 동기화하고, 생산자와 소비자의 대기 조건을 관리한다.

### ✍️ 독자-저자 문제 (Readers-Writers Problem)

**독자-저자 문제**는 여러 프로세스가 공유 데이터에 접근할 때 발생하는 동기화 문제.

* **독자(Readers)**: 데이터를 읽기만 한다. 여러 독자가 동시에 접근해도 안전!
* **저자(Writers)**: 데이터를 수정한다. 한 번에 한 저자만 접근해야 하며, 독자와도 동시에 접근할 수 없다.
* **문제**: 여러 독자가 동시에 읽는 것은 허용하면서, 저자가 접근할 때는 모든 접근을 막아야 함.
* **해결**: 읽기/쓰기 접근을 제어하기 위해 세마포어나 모니터를 활용함.