# 파일 시스템 기초

## 개념

- 운영체제가 저장 장치(HDD, SSD) 위에 데이터를 효율적이고 안정적으로 저장, 관리하기 위해 만든 소프트웨어 계층
- 같은 하드디스크라도 어떤 파일 시스템 쓰느냐에 따라 내부 구조 완전히 달라짐
- ex. Windows - NTFS, Linux - ext4, macOS - APFS

## 파일의 구성요소

### 파일

- 저장장치에 기록된 논리적 데이터 단위
- ex. 문서, 실행파일, 이미지 등

### 파일 속성 (=Meta Data)

- 파일을 설명하는 데이터. not 파일 내용
- 파일 이름, 크기, 새성/수정/접근 시간, 접근 권한, 파일 저장된 디스크 블록의 위치 정보 등

## 디렉토리 구조

### 디렉토리 (Directory)

- 파일들을 체계적으로 관리하기 위한 논리적 그룹

### 디렉토리 구조

- 트리(tree) 형태

```python
/
├── home/
│   └── user/
│       ├── report.docx
│       └── photo.jpg
└── etc/
    └── config.txt
```

- / : 최상위 디렉토리 (루트(root))
- 경로(path) : 트리 안에서 파일의 위치를 나타내는 주소

## 파일 저장 방식

- 파일은 보통 하드디스크의 여러 block에 나누어 저장
- 연속 할당, 연결 할당, 인덱스 할당

### 연속 할당 (Contiguous)

- 파일을 하나의 연속된 공간에 저장
- 빠름
- 중간에 파일 지워지면 외부 단편화 발생

### 연결 할당 (Linked)

- 파일을 여러 조각으로 나누어 각 조각이 다음 조각의 주소를 가리킴
- 체인처럼 연결
- 공간 낭비 줄임
- 중간 블록 찾기 위해 연결을 따라가야 하므로 느림

### 인덱스 할당 (Indexed)

- 인덱스 블록을 따로 두고, 그 안에 실제 데이터 블록들의 주소 모아둠
- 중간에 끊기지 않고 빠르게 접근 가능
- 현대의 파일 시스템은 대부분 인덱스 기반 구조(inode 기반) 사용

## 파일 시스템 내부 구조

### 파일 제어 블록 (FCB, inode)

- 파일의 메타데이터를 저장하는 구조체
- 파일 이름은 디렉토리에 저장, 디렉토리는 파일 이름 → inode 번호로 연결

### 데이터 블록 (Data Block)

- 실제 파일 내용이 저장되는 단위

### 슈퍼블록 (Superblock)

- 파일 시스템 전체 정보를 저장
- 전체 블록 수, 사용 가능한 블록 수, inode 개수 등

## 공간 관리

### 비트맵 (Bitmap)

- 각 블록마다 1(사용중), 0(비어있음)으로 표시

### 연결 리스트

- 빈 블록들을 체인처럼 연결

### 그룹화

- 비어있는 블록들을 묶어서 관리 (대용량 시스템에서 사용)

## 접근 제어와 보호

- 보안을 위해 파일마다 권한 존재
- 리눅스 ex.  `-rwxr-xr--`
    - 첫 글자 : `-` = 파일, `d` = 디렉토리
    - `rwx` = 읽기, 쓰기, 실행
    - 소유자/그룹/기타 사용자 순서

## 마운트

- 운영체제는 여러 개의 디스크를 하나의 트리로 관리
- 외부 저장장치(USB, SSD 등)를 기존 트리의 한 부분에 붙이는 과정
- ex. `sudo mount /dev/sdb1 /mnt/usb`
    - `/dev/sdb1` 장치(USB)를 `/mnt/usb` 폴더에 연결
    - 마운트를 해야 `/mnt/usb` 경로에 가서 파일 볼 수 있음

## 저널링과 복구

### 저널링 (Journaling)

- 모든 변경 내역을 로그(journal)에 먼저 기록, 이후 실제 데이터에 반영
- 시스템이 갑자기 꺼져도 로그 읽어서 복구 가능
- ext3, NTFS, XFS 등이 저널링 지원

## 대표 파일 시스템 종류

| 운영체제 | 파일 시스템 | 특징 |
| --- | --- | --- |
| Windows | NTFS | 저널링, 보안 기능, 대용량 지원 |
| Linux | ext4 | 안정성, 속도, 저널링 지원 |
| macOS | APFS | SSD 최적화, 스냅샷 기능 |
| 외장장치 | exFAT | 여러 OS 간 호환성 높음 |