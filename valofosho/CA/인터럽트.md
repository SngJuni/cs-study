# 인터럽트 (Interrupt)

## 인터럽트란?
CPU가 프로그램 실행 중 외부나 내부에서 발생한 사건에 반응하기 위해, 현재 실행을 잠시 중단하고 해당 사건을 우선 처리하는 메커니즘  
→ 간단히 말해, 급한 일이 생기면 CPU에게 알려서 우선 처리하게 하는 시스템

* 명령어 사이클 : 하나의 명령어를 처리하는 정형화된 흐름 (Fetch → Decode → Execute → Interrupt Check)

---

## 필요성
- CPU와 I/O 장치의 속도 차이 해결
  - CPU 속도 >> I/O 장치 속도
  - CPU가 I/O 완료를 계속 기다리면 자원 낭비
  - 인터럽트를 이용하면 CPU는 다른 일을 하다가 사건이 발생했을 때만 반응 가능
- 비동기적 사건 처리
  - 예측 불가능한 이벤트(사용자 입력, 하드웨어 오류 등)에 즉시 대응 가능
- 효율적인 자원 관리
  - 운영체제가 프로세스를 관리·전환(Context Switching)할 때 인터럽트를 활용

---

## 인터럽트 종류

### 하드웨어 인터럽트
- CPU 외부 장치에서 발생
- 예: 키보드 입력, 마우스 클릭, 디스크 I/O 완료, 타이머 신호

### 소프트웨어 인터럽트
- 프로그램 명령어 실행에 의해 발생
- 예: INT n 명령어(x86), 시스템 콜(System Call), 예외(Exception)
- CPU가 명령 실행 중 동기적으로 발생
- 예시
  - 0으로 나누기 (Divide by Zero)
  - 페이지 폴트 (Page Fault)
  - 잘못된 명령어 실행

### 내부 인터럽트 (Exception)
- CPU 내부에서 오류나 예외 상황으로 발생
- 소프트웨어 인터럽트와 겹치는 경우가 많음
- 예: 보호 위반, 잘못된 명령어

---

## 인터럽트 처리 과정

1. 이벤트 발생  
   - 하드웨어 장치(I/O 완료 등) → 인터럽트 요청 신호  
   - 소프트웨어 명령어(System Call 등) → 인터럽트 실행
2. CPU는 실행 사이클이 끝난 후 인터럽트 여부 확인
3. 인터럽트 플래그를 확인해 수용 가능한 경우 인터럽트 수락
4. 현재 작업 상태(PC, 레지스터 값)를 저장 (컨텍스트 저장)
5. 인터럽트 벡터 테이블에서 ISR(Interrupt Service Routine, 인터럽트 서비스 루틴) 주소 확인
6. ISR 실행 (인터럽트 처리)
7. ISR 종료 후 저장해 둔 상태를 복원하고 원래 프로그램으로 복귀

---

## 인터럽트 관련 용어

- 인터럽트 요청 신호 (IRQ)  
  : 장치가 CPU에 서비스 요청을 보낼 때 사용하는 신호
- 인터럽트 플래그  
  : 하드웨어 인터럽트를 받아들일지 여부를 제어하는 플래그  
  (비활성화 시 무시 가능, 단 전원 이상 같은 치명적 신호는 항상 수용)
- 인터럽트 서비스 루틴 (ISR, Interrupt Handler)  
  : 해당 인터럽트를 처리하는 프로그램
- 인터럽트 벡터  
  : ISR의 시작 주소를 담은 정보

---

## Polling vs 인터럽트

### Polling (바쁜 대기)
- CPU가 주기적으로 장치 상태를 확인
- 장점: 구현이 단순
- 단점: CPU가 계속 확인해야 하므로 자원 낭비 큼

### 인터럽트
- 장치가 CPU에 직접 알림
- 장점: CPU 효율 증가, 실시간 반응 가능
- 단점: 하드웨어와 운영체제 설계가 복잡

---

## 인터럽트 동시 발생 시 처리

1. 요청된 인터럽트 중 우선순위가 가장 높은 인터럽트부터 식별
2. 현재 실행 중인 작업 상태를 저장
3. 우선순위 순서대로 ISR 실행
4. 처리 중 더 높은 우선순위 인터럽트가 발생하면 즉시 전환
5. 모든 인터럽트 처리 완료 후, 원래 작업을 복원하여 실행 재개

---

## 명령어 사이클과 인터럽트
CPU는 매 명령어 사이클의 끝에서 인터럽트 발생 여부를 확인

- Fetch → Decode → Execute → Interrupt Check

이 과정을 통해 CPU는 명령어 실행의 원자성을 보장하면서도 외부 사건에 대응할 수 있음
