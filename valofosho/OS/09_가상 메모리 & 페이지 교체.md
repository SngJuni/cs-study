# 가상 메모리 (Virtual Memory)

## 1. 개념

* 실제 물리 메모리(RAM)보다 **큰 공간을 사용하는 것처럼 보이게 하는 기술**
* 프로그램 전체를 올리지 않고, **실행에 필요한 부분만 메모리에 적재**
* 나머지는 **디스크(보조기억장치)** 에 저장

---

## 2. 동작 원리

* 프로그램이 사용하는 주소 = **가상 주소**
* 실제 RAM에 있는 주소 = **물리 주소**
* CPU는 가상 주소로 요청 → **MMU(Memory Management Unit)** 가 페이지 테이블을 참고하여 물리 주소로 변환

---

## 3. 페이지 부재 (Page Fault)

* CPU가 요청한 페이지가 RAM에 없을 때 발생
* OS가 디스크에서 해당 페이지를 읽어와 RAM에 적재
* RAM이 꽉 차 있으면 → **페이지 교체(Page Replacement)** 필요

---

# 페이지 교체 (Page Replacement)

## 예시 상황

* **프레임 수: 3개**
* **페이지 요청 순서:** 7, 0, 1, 2, 0, 3, 0, 4

---

### (1) FIFO (First-In First-Out)

* 가장 먼저 들어온 페이지부터 내보냄

| 요청 | 프레임 상태  | 교체?     |
| -- | ------- | ------- |
| 7  | [7]     | -       |
| 0  | [7,0]   | -       |
| 1  | [7,0,1] | -       |
| 2  | [2,0,1] | ✅ 7 out |
| 0  | [2,0,1] | -       |
| 3  | [3,0,1] | ✅ 2 out |
| 0  | [3,0,1] | -       |
| 4  | [4,0,1] | ✅ 3 out |

👉 단순하지만, 오래된 페이지가 여전히 자주 쓰일 수 있음.

---

### (2) LRU (Least Recently Used)

* 가장 오래 사용되지 않은 페이지를 내보냄

| 요청 | 프레임 상태  | 교체?          |
| -- | ------- | ------------ |
| 7  | [7]     | -            |
| 0  | [7,0]   | -            |
| 1  | [7,0,1] | -            |
| 2  | [2,0,1] | ✅ 7 out      |
| 0  | [2,0,1] | - (0 사용 최신화) |
| 3  | [3,0,2] | ✅ 1 out      |
| 0  | [3,0,2] | - (0 최신화)    |
| 4  | [4,0,3] | ✅ 2 out      |

👉 실제 사용 패턴과 가장 비슷 → 성능이 좋음.

---

### (3) Optimal (OPT)

* **앞으로 가장 늦게 쓰일 페이지** 를 내보냄 (이론적 최적)

| 요청 | 프레임 상태  | 교체?                     |
| -- | ------- | ----------------------- |
| 7  | [7]     | -                       |
| 0  | [7,0]   | -                       |
| 1  | [7,0,1] | -                       |
| 2  | [2,0,1] | ✅ 7 out (앞으로 가장 늦게 사용됨) |
| 0  | [2,0,1] | -                       |
| 3  | [3,0,2] | ✅ 1 out                 |
| 0  | [3,0,2] | -                       |
| 4  | [4,0,3] | ✅ 2 out                 |

👉 항상 가장 적은 Page Fault 발생 (하지만 미래 예측 불가능 → 실제 구현 불가).

---

### (4) Clock (Second-Chance)

* FIFO 개선판, **참조 비트(Reference Bit)** 사용
* 시계 바늘처럼 돌면서 `0`이면 교체, `1`이면 기회 주고 다시 검사

👉 구현이 간단하고 FIFO보다 효율적, LRU보다는 조금 떨어질 수 있음.

---

## 4. 비교 정리

| 알고리즘    | 동작 원리              | 장점                      | 단점                        |
| ------- | ------------------ | ----------------------- | ------------------------- |
| FIFO    | 가장 먼저 들어온 페이지 교체   | 단순, 구현 쉬움               | 성능 불안정 (Belady’s anomaly) |
| LRU     | 가장 오래 안 쓴 페이지 교체   | 실제 사용 패턴과 유사            | 구현 복잡, 오버헤드               |
| Optimal | 앞으로 가장 늦게 쓸 페이지 교체 | Page Fault 최소화 (이론적 최적) | 미래 예측 불가                  |
| Clock   | FIFO + 참조 비트 활용    | 효율적, 구현 용이              | 성능은 LRU보다 낮을 수 있음         |

---

## 5. 핵심 요약

* **가상 메모리** = 실제 메모리보다 큰 공간처럼 보이게, 필요한 페이지만 올림
* **페이지 부재** 발생 시 디스크에서 불러옴 → 페이지 교체 필요
* 주요 알고리즘: FIFO(단순), LRU(현실적), Optimal(이론적), Clock(근사)
