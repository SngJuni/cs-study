# 📂 파일 시스템 (File System)

운영체제가 **보조기억장치(HDD, SSD 등)**의 데이터를 관리하는 구조.  
프로그램이 파일을 읽고 쓰는 과정을 효율적이고 안전하게 수행하기 위한 핵심 구성.

---

## 1. 개념

- 데이터를 **파일 단위로 저장 및 관리**하는 시스템  
- 디스크의 물리적 블록을 논리적으로 **조직화 및 추상화**  
- 파일 접근, 저장, 삭제, 복구 등의 기능 제공  

💡 **예시**  
- Windows → `NTFS`  
- macOS → `APFS`  
- Linux → `EXT4`  
- USB, SD카드 → `FAT32` 또는 `exFAT`

---

## 2. 파일 시스템 구조

```

[Application]
↓
[System Call Interface]
↓
[File System Layer]
↓
[Buffer Cache]
↓
[Device Driver]
↓
[Disk Controller → Physical Disk]

```

각 계층은 상호 독립적으로 작동하며, **논리적 계층화 구조**로 파일 접근 관리 수행.

---

## 3. 주요 구성요소

| 구성요소 | 설명 | 예시 |
|-----------|------|------|
| **파일(File)** | 데이터의 논리적 집합 | `report.docx`, `data.csv` |
| **디렉터리(Directory)** | 파일을 그룹화한 계층 구조 | `/user/docs/project/` |
| **블록(Block)** | 파일이 저장되는 최소 단위 | 4KB 블록 단위 저장 |
| **메타데이터(Metadata)** | 파일 속성 정보 | 생성일, 권한, 크기 |
| **인덱스 블록(Index Block)** | 파일 블록 위치를 저장 | `inode` 구조체 내부 |

---

## 4. 파일 접근 방식

| 접근 방식 | 설명 | 예시 |
|-------------|------|------|
| **순차 접근 (Sequential Access)** | 처음부터 차례로 읽기 | 오디오/비디오 스트리밍 |
| **직접 접근 (Direct Access)** | 특정 블록으로 바로 이동 | 데이터베이스 파일 |
| **색인 접근 (Indexed Access)** | 색인 테이블 기반 접근 | 검색 엔진의 인덱스 파일 |

---

## 5. 파일 할당 기법

### ✅ 1) 연속 할당 (Contiguous Allocation)
- 파일을 **연속된 블록에 저장**
- 빠른 접근 속도  
- **단편화(Fragmentation)** 발생 가능  

**예시**
```

파일 A: [1][2][3][4]
파일 B: [5][6][7][8]

```
→ A 삭제 시 중간 공간이 비어 단편화 발생.

---

### ✅ 2) 연결 할당 (Linked Allocation)
- 각 블록이 **다음 블록의 주소를 포인터로 연결**
- 외부 단편화 제거, 임의 접근 비효율  

**예시**
```

파일 A → [5]→[17]→[23]→NULL

```
→ FAT(File Allocation Table) 방식이 대표적.

---

### ✅ 3) 인덱스 할당 (Indexed Allocation)
- 별도 **인덱스 블록**을 만들어 블록 주소 저장  
- 랜덤 접근 가능, 오버헤드 증가  

**예시 (inode 기반 구조)**  
```

inode[3]
┣─ 블록1: 5
┣─ 블록2: 7
┣─ 블록3: 10

```
→ Linux EXT 계열이 이 방식을 사용.

---

## 6. 디렉터리 구조

| 구조 | 설명 | 예시 |
|------|------|------|
| **단일 디렉터리** | 모든 파일이 한곳에 존재 | 옛날 MS-DOS |
| **2단계 디렉터리** | 사용자별 디렉터리 분리 | `/user1/`, `/user2/` |
| **트리 구조** | 계층적 구조로 하위 폴더 구성 | `/home/donghyun/project/` |
| **비순환 그래프** | 하드 링크 지원 | 하나의 파일이 여러 경로에 존재 |
| **일반 그래프** | 순환 링크 가능, 관리 복잡 | 사용 지양 |

---

## 7. 파일 제어 및 관리

| 기능 | 설명 | 예시 |
|------|------|------|
| **생성(Create)** | 새 파일 생성 및 메타데이터 등록 | `touch log.txt` |
| **열기(Open)** | 파일 디스크립터 할당 | `fd = open("data.txt")` |
| **읽기(Read)** | 지정된 블록에서 데이터 읽기 | `read(fd, buffer)` |
| **쓰기(Write)** | 블록에 데이터 기록 | `write(fd, data)` |
| **닫기(Close)** | 파일 핸들 반환 | `close(fd)` |
| **삭제(Delete)** | 디렉터리 엔트리 제거 | `rm report.txt` |

---

## 8. 접근 권한 관리

| 권한 | 설명 | 예시 |
|------|------|------|
| **r (read)** | 읽기 권한 | `chmod 400 file` |
| **w (write)** | 쓰기 권한 | `chmod 200 file` |
| **x (execute)** | 실행 권한 | `chmod 100 file` |
| **소유자(owner)** | 파일 생성자 |
| **그룹(group)** | 동일 그룹 사용자 |
| **기타(other)** | 그 외 사용자 |

💡 예시  
`-rw-r--r--` → 소유자는 읽기/쓰기, 그룹과 기타는 읽기만 가능.

---

## 9. 파일 시스템의 성능 기법

| 기법 | 설명 | 예시 |
|------|------|------|
| **버퍼 캐시(Buffer Cache)** | 자주 사용하는 데이터 임시 저장 | 메모리 내 캐시 활용 |
| **저널링(Journaling)** | 변경 내역 로그 기록 후 반영 | NTFS, EXT4 |
| **RAID(Redundant Array of Independent Disks)** | 여러 디스크 병렬 사용 | RAID 0, 1, 5 등 |
| **Lazy Write** | 쓰기 요청을 일정 시간 후 일괄 처리 | I/O 효율 향상 목적 |

---

## 10. 파일 시스템 예시 비교

| 구분 | FAT32 | NTFS | EXT4 |
|------|-------|------|------|
| 최대 파일 크기 | 4GB | 16TB | 16TB |
| 권한 관리 | 없음 | ACL 지원 | ACL 지원 |
| 저널링 | 없음 | 지원 | 지원 |
| 복구 기능 | 제한적 | 우수 | 우수 |
| 사용 환경 | USB, 메모리카드 | Windows | Linux |

